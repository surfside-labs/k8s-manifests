# Traefik Custom Configuration
# DaemonSet with hostNetwork for port-free HTTPS (standard ports 80/443)
# Multi-node compatible configuration

deployment:
  kind: DaemonSet
  podAnnotations:
    prometheus.io/port: "8082"
    prometheus.io/scrape: "true"

providers:
  kubernetesIngress:
    publishedService:
      enabled: true

priorityClassName: "system-cluster-critical"

image:
  repository: "rancher/mirrored-library-traefik"
  tag: "3.5.1"

tolerations:
- key: "CriticalAddonsOnly"
  operator: "Exists"
- key: "node-role.kubernetes.io/control-plane"
  operator: "Exists"
  effect: "NoSchedule"

# Enable host network for direct port binding
hostNetwork: true
dnsPolicy: ClusterFirstWithHostNet

service:
  type: ClusterIP
  ipFamilyPolicy: "PreferDualStack"

# Security context for binding privileged ports
securityContext:
  capabilities:
    add:
      - NET_BIND_SERVICE

# Standard ports configuration with host binding
ports:
  web:
    port: 8000
    expose:
      default: true
    exposedPort: 80
    hostPort: 80
  websecure:
    port: 8443
    expose:
      default: true
    exposedPort: 443
    hostPort: 443
    http3:
      enabled: false
    tls:
      enabled: true
  traefik:
    port: 9000
    expose:
      default: false
