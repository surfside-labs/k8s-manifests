# Traefik Custom Configuration
# Deployment with hostNetwork for port-free HTTPS (standard ports 80/443)
# Note: Using Deployment instead of DaemonSet for single-node cluster
# The Traefik Helm chart requires maxUnavailable > 1 for DaemonSet with hostNetwork

deployment:
  replicas: 1
  podAnnotations:
    prometheus.io/port: "8082"
    prometheus.io/scrape: "true"

providers:
  kubernetesIngress:
    publishedService:
      enabled: true

priorityClassName: "system-cluster-critical"

image:
  repository: "rancher/mirrored-library-traefik"
  tag: "3.5.1"

tolerations:
- key: "CriticalAddonsOnly"
  operator: "Exists"
- key: "node-role.kubernetes.io/control-plane"
  operator: "Exists"
  effect: "NoSchedule"

# Enable host network for direct port binding
hostNetwork: true
dnsPolicy: ClusterFirstWithHostNet

service:
  type: ClusterIP
  ipFamilyPolicy: "PreferDualStack"

# Security context for binding privileged ports
# Note: Running as root is required for hostNetwork with privileged ports
podSecurityContext:
  runAsUser: 0
  runAsGroup: 0
  runAsNonRoot: false

securityContext:
  capabilities:
    add:
      - NET_BIND_SERVICE
    drop:
      - ALL
  readOnlyRootFilesystem: true
  allowPrivilegeEscalation: false

# Standard ports configuration with host binding
# Note: With hostNetwork, hostPort must match containerPort
ports:
  web:
    port: 80
    expose:
      default: true
    exposedPort: 80
    hostPort: 80
  websecure:
    port: 443
    expose:
      default: true
    exposedPort: 443
    hostPort: 443
    http3:
      enabled: false
    tls:
      enabled: true
  traefik:
    port: 9000
    expose:
      default: false
